!function(e,a,t,d){function r(){e("#edd-vat-check-result").remove()}function n(e,a){e.append('<span id="edd-vat-check-result" class="edd-vat-check-result edd-vat-check-error">'+a+"</span>")}a.euCountries=d.countries;var c=function(a){var c=e("#edd-card-vat-wrap"),o=e("#billing_country").val(),i=e("#edd-vat-number").val();if(!c.length)return!1;if(c.data("check"))return!1;if(r(),!i)return n(c,d.messages.vat_number_missing),!1;if(!o)return n(c,d.messages.country_missing),!1;var s={action:"edd_vat_check",billing_country:o,vat_number:i,nonce:e("#edd-checkout-address-fields-nonce").val()};c.data("check",!0);var u=e('<span class="edd-loading-ajax edd-loading"></span>');return e("#edd-vat-check-button").after(u),e(t.body).trigger("edd_eu_vat:before_vat_check",s),e.ajax({type:"POST",data:s,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0}}).done((function(a,r,o){if(200==o.status&&void 0!==a.html){var i=e(e.parseHTML(a.html.trim())).filter("#edd_checkout_cart_form");i.length&&e("#edd_checkout_cart_form").replaceWith(i),e(".edd_cart_amount").html(a.total),c.append(a.vat_check_result),0===a.tax_rate_raw&&d.hide_edd_sl_notices&&(e("#edd-recurring-sl-auto-renew").each((function(){e(this).remove()})),e("#edd-recurring-sl-cancel-replace").each((function(){e(this).remove()})));var u={postdata:s,response:a};e(t.body).trigger("edd_taxes_recalculated",u).trigger("edd_eu_vat:vat_check",a)}else n(c,d.messages.ajax_error)})).fail((function(e,a,t){n(c,d.messages.ajax_error)})).always((function(){u.remove(),c.data("check",!1),e(t.body).trigger("edd_eu_vat:vat_check_complete")})),!1};function o(){if(d.countries){var a=e("#billing_country").val();a&&-1!==d.countries.indexOf(a)?e("#edd-card-vat-wrap").show():(e("#edd-card-vat-wrap").hide(),r())}}e((function(){e("#edd_purchase_form").on("click","#edd-vat-check-button",c).on("change","#billing_country",(function(a){var t=e("#edd-vat-check-result").data();t&&t.valid&&t.country&&t.country!==e(this).val()&&(e("#edd-vat-number").val(""),r()),o()})).on("change","#edd-stripe-update-billing-address",(function(e){o()}))})),e(t.body).on("edd_gateway_loaded",(function(a,t){o(),e("#edd-stripe-add-new").on("change",(function(e){o()}))}))}(jQuery,window,document,edd_eu_vat_params);