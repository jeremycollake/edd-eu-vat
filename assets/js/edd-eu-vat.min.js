window.EDD_EU_VAT=function(e,t,a,d){function r(){e("#edd-vat-check-result").remove()}function n(e,t){e.append('<span id="edd-vat-check-result" class="edd-vat-check-result edd-vat-check-error">'+t+"</span>")}t.euCountries=d.countries;var c=function(t){var c=e("#edd-card-vat-wrap"),o=e("#billing_country").val(),i=e("#edd-vat-number").val();if(!c.length)return!1;if(c.data("check"))return!1;if(r(),!i)return n(c,d.messages.vat_number_missing),!1;if(!o)return n(c,d.messages.country_missing),!1;var u={action:"edd_vat_check",billing_country:o,vat_number:i,nonce:e("#edd-checkout-address-fields-nonce").val()};c.data("check",!0);var s=e('<span class="edd-loading-ajax edd-loading"></span>');return e("#edd-vat-check-button").after(s),e(a.body).trigger("edd_eu_vat:before_vat_check",u),e.ajax({type:"POST",data:u,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0}}).done((function(t,r,o){if(200==o.status&&void 0!==t.html){var i=e(e.parseHTML(t.html.trim())).filter("#edd_checkout_cart_form");i.length&&e("#edd_checkout_cart_form").replaceWith(i),e(".edd_cart_amount").html(t.total),c.append(t.vat_check_result),0===t.tax_rate_raw&&d.hide_edd_sl_notices&&(e("#edd-recurring-sl-auto-renew").each((function(){e(this).remove()})),e("#edd-recurring-sl-cancel-replace").each((function(){e(this).remove()})));var s={postdata:u,response:t};e(a.body).trigger("edd_taxes_recalculated",s).trigger("edd_eu_vat:vat_check",t)}else n(c,d.messages.ajax_error)})).fail((function(e,t,a){n(c,d.messages.ajax_error)})).always((function(){s.remove(),c.data("check",!1),e(a.body).trigger("edd_eu_vat:vat_check_complete")})),!1};function o(){if(d.countries){var t=e("#billing_country").val();t&&-1!==d.countries.indexOf(t)?e("#edd-card-vat-wrap").show():(e("#edd-card-vat-wrap").hide(),r())}}return e((function(){e("#edd_purchase_form").on("click","#edd-vat-check-button",c).on("change","#billing_country",(function(t){var a=e("#edd-vat-check-result").data();a&&a.valid&&a.country&&a.country!==e(this).val()&&(e("#edd-vat-number").val(""),r()),o()})).on("change","#edd-stripe-update-billing-address",(function(e){o()}))})),e(a.body).on("edd_gateway_loaded",(function(t,a){o(),e("#edd-stripe-add-new").on("change",(function(e){o()}))})),e((function(){e("#edd_purchase_form").on("change","#billing_country",(function(t){e("#edd-purchase-button, #billing_country").attr("disabled",!0)}))})),e(a.body).on("edd_taxes_recalculated",(function(t,a){const d=e(".edd_cart_amount"),r=a?.response?.total_raw;void 0!==r&&d.attr("data-total",r),e("#edd-purchase-button, #billing_country").removeAttr("disabled")})),{checkVatNumber:c,checkCountry:o}}(jQuery,window,document,edd_eu_vat_params);