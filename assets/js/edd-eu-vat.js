window.EDD_EU_VAT=function(e,t,a,d){t.euCountries=d.countries;const n="1"===edd_eu_vat_params.debug_mode,r=[];function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n&&(r.push({message:e,data:t,date:(new Date).toLocaleString()}),localStorage.setItem("euVatLogger",JSON.stringify(r)))}function o(){e("#edd-vat-check-result").remove()}function i(e,t){e.append('<span id="edd-vat-check-result" class="edd-vat-check-result edd-vat-check-error">'+t+"</span>")}var u=function(t){var n=e("#edd-card-vat-wrap"),r=e("#billing_country").val(),u=e("#edd-vat-number").val();if(c("eddVatCheck running",{billingCountry:r,vatNumber:u}),!n.length)return!1;if(n.data("check"))return!1;if(o(),!u)return i(n,d.messages.vat_number_missing),!1;if(!r)return i(n,d.messages.country_missing),!1;var l={action:"edd_vat_check",billing_country:r,vat_number:u,nonce:e("#edd-checkout-address-fields-nonce").val()};n.data("check",!0);var s=e('<span class="edd-loading-ajax edd-loading"></span>');return e("#edd-vat-check-button").after(s),e(a.body).trigger("edd_eu_vat:before_vat_check",l),e.ajax({type:"POST",data:l,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0}}).done((function(t,r,c){if(200==c.status&&void 0!==t.html){var o=e(e.parseHTML(t.html.trim())).filter("#edd_checkout_cart_form");o.length&&e("#edd_checkout_cart_form").replaceWith(o),e(".edd_cart_amount").html(t.total),n.append(t.vat_check_result),0===t.tax_rate_raw&&d.hide_edd_sl_notices&&(e("#edd-recurring-sl-auto-renew").each((function(){e(this).remove()})),e("#edd-recurring-sl-cancel-replace").each((function(){e(this).remove()})));var u={postdata:l,response:t};e(a.body).trigger("edd_taxes_recalculated",u).trigger("edd_eu_vat:vat_check",t)}else i(n,d.messages.ajax_error)})).fail((function(e,t,a){i(n,d.messages.ajax_error)})).always((function(){s.remove(),n.data("check",!1),e(a.body).trigger("edd_eu_vat:vat_check_complete")})),!1};function l(){if(d.countries){var t=e("#billing_country").val();c("eddCountryCheck running",""),t&&-1!==d.countries.indexOf(t)?(e("#edd-card-vat-wrap").show(),c("eddCountryCheck showing #edd-cart-vat-wrap","")):(e("#edd-card-vat-wrap").hide(),o(),c("eddCountryCheck hiding #edd-cart-vat-wrap",""))}}return e((function(){e("#edd_purchase_form").on("click","#edd-vat-check-button",u).on("change","#billing_country",(function(t){c("#billing_country changed",e(this).val());var a=e("#edd-vat-check-result").data();a&&a.valid&&a.country&&a.country!==e(this).val()&&(e("#edd-vat-number").val(""),o()),l()})).on("change","#edd-stripe-update-billing-address",(function(e){c("#edd-stripe-update-billing-address changed",""),l()}))})),e(a.body).on("edd_gateway_loaded",(function(t,a){c("running eddCountryCheck on edd_gateway_loaded event"),l(),e("#edd-stripe-add-new").on("change",(function(e){c("running eddCountryCheck on #edd-stripe-add-new click"),l()}))})),e((function(){e("#edd_purchase_form").on("change","#billing_country",(function(t){e("#edd-purchase-button, #billing_country").attr("disabled",!0)}))})),e(a.body).on("edd_taxes_recalculated",(function(t,a){var d;const n=e(".edd_cart_amount"),r=null==a||null===(d=a.response)||void 0===d?void 0:d.total_raw;void 0!==r&&n.attr("data-total",r),c("updating data-total attribute",{rawTax:r}),e("#edd-purchase-button, #billing_country").removeAttr("disabled")})),{checkVatNumber:u,checkCountry:l}}(jQuery,window,document,edd_eu_vat_params);